import requests
import dotenv
import os
from io import BytesIO
from PIL import Image

dotenv.load_dotenv()

JUPYTER_URL = os.environ["JUPYTER_URL"]
# TOKEN = os.environ["TOKEN"]

# 요청 데이터 (서버에 보낼 JSON 데이터)
payload = {
    "genre": "romance",
    "style": "studio_ghibli",
    "title": "곰탱이 류현웅의 러브 스토리",
    "worldview": """ ## 곰탱이 류현웅의 러브 스토리 세계관 설정

### 1. 기본 설정

*   **시대:** 현대, 2024년 대한민국을 배경으로 한다. 현실적인 배경을 기반으로 하되, 주인공 류현웅과 주변 인물들의 개성을 강조하여 평범함 속에서 특별한 로맨스를 만들어낸다.
*   **핵심 테마:** '외모지상주의' 사회 속 진정한 사랑 찾기. 덩치 크고 순박한 곰 같은 남자 류현웅이 외모로 평가받는 사회 속에서 자신의 진가를 알아봐 주는 사람을 만나 사랑을 이루는 과정을 그린다. 겉모습 이 아닌 내면의 아름다움과 순수한 마음이 사랑의 중요한 요소임을 보여준다.

### 2. 지리적 배경

*   **세계 전체의 구조:** 대한민국, 특히 서울을 중심으로 이야기가 전개된다. 류현웅의 직장, 집, 데이트 장소 등 주요 배경은 서울 내에서도 특정 지역(예: 강남, 홍대, 대학로)으로 설정하여 현실감을 더한다.
*   **주요 지형 및 자연 환경:** 서울의 도심 풍경과 한강, 공원 등 자연 환경이 어우러진 모습이 배경으로 등장한다. 류현웅의 듬직한 이미지를 부각하기 위해 넓은 한강 공원이나 탁 트인 전망을 가진 장소를 활용한다.
*   **상징적이거나 중요한 장소:**
    *   **류현웅의 단골 식당:** 소박하고 정겨운 분위기의 식당으로, 류현웅의 따뜻한 마음씨를 보여주는 장소이다.
    *   **두 주인공의 첫 만남 장소:** 우연한 만남이 이루어지는 특별한 장소로, 두 사람의 인연을 상징한다. 예를 들어, 비 오는 날 우산이 없는 여주인공에게 류현웅이 우산을 씌워주는 장면이 연출될 수 있다.
    *   **추억이 깃든 공원:** 두 사람이 데이트하며 서로에게 마음을 열게 되는 장소로, 사랑의 감정을 키워나가는 중요한 공간이다.

### 3. 역사와 문화

*   **세계의 건국 신화 및 주요 역사적 사건:** 현대 대한민국을 배경으로 하므로, 특별한 건국 신화나 역사적 사건은 등장하지 않는다. 다만, 한국 사회의 외모지상주의적 경향과 그로 인한 사회적 편견을 간접적으로 드러낸다.
*   **사회 구조:** 현대 한국 사회의 일반적인 사회 구조를 따른다. 정치 체제는 민주주의, 경제 시스템은 자본주의를 기반으로 한다. 계층 구조는 학력, 직업, 재산 등에 따라 나뉘지만, 로맨스 소설인 만큼 계층  간 갈등보다는 개인의 사랑에 초점을 맞춘다.
*   **문화와 종교:** 한국의 전통 문화와 현대 문화가 공존하는 사회이다. 특별한 종교적 신념은 등장하지 않지만, 한국인의 일반적인 가치관(예: 가족 중시, 예의범절)이 인물들의 행동에 영향을 미친다. 류현웅의 순박하고 예의 바른 성격은 이러한 한국 문화의 영향을 받은 것으로 설정한다.

### 4. 기술 및 초자연적 요소

*   **세계 내 기술 수준:** 현대 한국 사회의 기술 수준을 반영한다. 스마트폰, 인터넷, SNS 등 현대 기술이 일상생활에 깊숙이 자리 잡고 있으며, 이는 인물들의 소통 방식과 관계 형성에 영향을 미친다.
*   **마법이나 초자연적 현상:** 현실적인 로맨스 소설이므로 마법이나 초자연적 현상은 등장하지 않는다.

### 5. 인물 및 종족

*   **주요 인물:**
    *   **류현웅:** 덩치 크고 순박한 외모를 가진 남자 주인공. 겉모습과는 달리 따뜻하고 순수한 마음을 가졌으며, 어려운 사람을 보면 그냥 지나치지 못하는 정의로운 성격이다. 직장에서는 묵묵히 자신의 일을  처리하며 동료들에게 신뢰를 받는 존재이다.
    *   **여주인공 (이름 미정):** 아름다운 외모를 가졌지만, 외모지상주의 사회에 지쳐 진정한 가치를 추구하는 여성. 류현웅의 외모가 아닌 내면의 따뜻함과 순수함에 끌려 사랑에 빠진다.
    *   **류현웅의 친구 (이름 미정):** 류현웅의 가장 친한 친구로, 류현웅의 듬직한 면모와 따뜻한 마음씨를 잘 알고 있다. 류현웅에게 조언을 해주는 역할을 한다.
    *   **여주인공의 친구 (이름 미정):** 여주인공의 가장 친한 친구로, 여주인공의 고민을 들어주고 조언을 해주는 역할을 한다.
*   **각 인물/종족이 속한 사회적, 문화적 배경:**
    *   류현웅은 평범한 가정에서 자라 한국 사회의 일반적인 가치관을 내면화했다. 넉넉하지 않은 형편에도 긍정적인 마음을 유지하며 살아왔으며, 어려운 사람을 돕는 것을 당연하게 여긴다.
    *   여주인공은 화려한 외모 덕분에 어릴 때부터 주목을 받았지만, 외모로만 평가받는 현실에 지쳐 내면의 가치를 중시하게 되었다.

### 6. 갈등 구조

*   **사회 내부의 갈등 요소:**
    *   **외모지상주의:** 류현웅은 덩치 큰 외모 때문에 사회적 편견에 직면한다. 사람들은 그의 외모만 보고 그를 평가하며, 그의 진가를 알아봐 주지 않는다.
    *   **가치관의 충돌:** 외모를 중시하는 사회적 분위기와 내면의 아름다움을 추구하는 여주인공의 가치관이 충돌한다.
*   **갈등의 진행 과정:**
    *   류현웅은 자신의 외모 때문에 자신감을 잃고 사랑에 소극적으로 변한다.
    *   여주인공은 류현웅의 따뜻한 마음과 순수한 모습에 끌리지만, 주변의 시선 때문에 망설인다.
    *   두 사람은 서로의 진심을 확인하고 사랑을 키워나가면서 사회적 편견에 맞서 싸운다.
*   **갈등이 전체 세계관에 미치는 영향:**
    *   류현웅과 여주인공의 사랑은 외모지상주의 사회에 경종을 울리고, 진정한 사랑의 의미를 되새기게 한다.
    *   소설은 독자들에게 외모가 아닌 내면의 아름다움을 발견하고 가치를 부여하는 메시지를 전달한다.

### 7. 세부 설정 및 고유 용어

*   **고유 용어:**
    *   **곰탱이:** 류현웅을 지칭하는 애칭. 덩치 크고 순박한 류현웅의 이미지를 강조하며, 친근하고 귀여운 느낌을 준다.
    *   **현웅이표 미소:** 류현웅의 트레이드 마크인 순수한 미소. 주변 사람들을 기분 좋게 만드는 류현웅의 매력을 보여준다.
*   **참고 자료:**
    *   한국 사회의 외모지상주의 관련 통계 및 기사 자료
    *   서울의 데이트 명소 및 맛집 정보
    *   현대 한국인의 가치관 및 연애관 관련 자료

이러한 세계관 설정을 바탕으로 류현웅과 여주인공의 사랑 이야기를 풀어나가면, 독자들은 더욱 몰입감 있게 소설을 즐길 수 있을 것이다.""",
    "keywords": ["dragon", "knight", "adventure"]
}

# 요청 헤더
headers = {"Content-Type": "application/json"}

# 서버에 POST 요청 보내기
response = requests.post(JUPYTER_URL + "/api/v1/editor/image_ai", json=payload, headers=headers)

# 응답이 정상적인지 확인
if response.status_code == 200:
    print("✅ 이미지 생성 성공!")

    # 응답된 이미지 데이터를 BytesIO 객체로 변환
    img_data = BytesIO(response.content)

    # PIL로 이미지 열기
    image = Image.open(img_data)

    # 🖼️ 이미지 띄우기
    image.show()

    # 💾 이미지 저장
    image.save("./generated_image.png", format="PNG")
    print("📸 이미지가 'generated_image.png'로 저장되었습니다.")

else:
    print(f"❌ 오류 발생: {response.status_code}, {response.text}")
